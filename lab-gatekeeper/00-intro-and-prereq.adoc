image:logoopenshift.png[logoopenshift, width=150, height=150]
image:logokubernetes.png[logokubernetes, width=150, height=150]
image:logogatekeeper.svg[logogatekeeper, width=150, height=150]

= Introduction & Warm up
:author: Coral Romero
:email: cromerob@redhat.com
:imagesdir: ./images
:toc: left
:toc-title: Lab 0 - Warming up

[Abstract]

WARNING: This is not a recommended practices guide nor intended to serve as a reference. These series of labs are oriented in such a way that you will have a first contact to the main concepts of Open Policy Agent and Gatekeeper operator.

In this preparation lab, we are going to get the `oc` cli binary and validate that all necessary requirements are successfully accomplished before starting the series of labs. 

Along these labs, you will refer to a list of variables that have been shared with you before starting the labs. If this is not your case, please let us know. 

These variables are:

- *$OCP_CONSOLE*: url for accessing to the 
Openshift web console
- *$OCP_API*: Openshift API endpoint. We will use this endpoint when accesing the cluster from the `oc` cli.
- *$USER*: your private user id used for Openshift authentication
- *$PASSWORD*:  your secret password used for Openshift authentication
- *$APPS_NS*: namespace where you will deploy your apps during the whole series of labs

Feel free to export these variables in your environment.

There is also a list of files needed to run the labs. These files can be found in the following github repository:

https://gitlab.consulting.redhat.com/cromerob/lab-opa-gatekeeper/-/tree/master/lab-gatekeeper-files

Clone the repository to your desired location, that will then be referred as *$LABS_HOME* during the labs:

....
$ git clone https://gitlab.consulting.redhat.com/cromerob/lab-opa-gatekeeper.git
....

:numbered:
== Access to Openshift Web Console

Use the `*$OCP_CONSOLE*` url to acces the Openshift Web Console. 

A login screen will be shown as follow after selecting `Local Password`:

image:login.png[login]

Enter your `username` and `password` and click `Log In`.

If you have successfully logged in, you will landed at the main dashboard with your current projects. As seen below, you should have access to 4 namespaces, `openshift-operators`, `petclinic-bluegreen-$USER`, `petclinic-beta-$USER` and `openshift-gatekeeper-system`.

image:namespaces.png[namespaces]

It is time to get the Openshift CLI binaries for your specific OS. 

=== Download the CLI 

On the top-right (?) menu, click on `Command line tools`:

image:menu.png[menu]

Then, choose the binaries according to your OS:

image:binaries.png[binaries]


Extract the binaries and try it by executing the following:

....
$ oc get clusterversion

NAME      VERSION   AVAILABLE   PROGRESSING   SINCE   STATUS
version   4.7.12    True        False         5d      Cluster version is 4.7.12
....

The above is an example of what you should get when running the command.

Finally verify you can log in from your terminal:

----
oc login -u $USER -p $PASSWORD $OCP_API
Login successful.

You have access to the following projects and can switch between them with ' project <projectname>':

  * openshift-gatekeeper-system
    openshift-operators
    petclinic-beta-$USER
    petclinic-bluegreen-$USER
----

=== Gatekeeper operator


Gatekeeper operator can be installed via Red Hat Marketplace or by creating a Subscription resource. For installing an operator you need to have `cluster-admin` role while your user has `gatekeeper-ops-role`.
This role limits the privileges of your user so you won't be able to run cluster wide actions but you will have enough privileges for create, get, list, delete, patch, update and watch gatekeeper resources among others.

Furthermore you will find a `Gatekeeper` resource created with the basic configuration needed for logs and audit feature.

Change your view mode to `Administrator` on the upper left banner and you can check the installed operator for this lab on `Operators` -> `Installed Operators`:

WARNING: Select namespace `openshift-operators`.

image:operator.png[operator]

Additionally you can check existing `Gatekeeper` resource with command:

WARNING: Your user only has permissions to get and list this resource.

----
oc get gatekeepers gatekeeper -o yaml
----

Otherwise you can navigate to `Gatekeeper` tab on the operator section:

image:gatekeeper.png[gatekeeper]


